# Sanoid Configuration for TrueNAS SCALE
# Generated by Ansible on {{ ansible_date_time.iso8601 | default('Check Mode - ' + lookup('pipe', 'date')) }}

[sanoid]
log_level = {{ sanoid_log_level }}
log_dir = {{ sanoid_log_dir }}

# Dataset configurations
{% for dataset, config in sanoid_datasets.items() %}
[{{ dataset }}]
use_template = {{ config.use_template }}
recursive = {{ config.recursive | lower }}
process_children_only = {{ config.process_children_only | lower }}
{% if config.exclude is defined %}
exclude = {{ config.exclude | join(',') }}
{% endif %}

{% endfor %}

# Template definitions
{% for template_name, template_config in sanoid_templates.items() %}
[template_{{ template_name }}]
frequently = {{ template_config.frequently }}
hourly = {{ template_config.hourly }}
daily = {{ template_config.daily }}
{% if template_config.weekly is defined %}
weekly = {{ template_config.weekly }}
{% endif %}
monthly = {{ template_config.monthly }}
yearly = {{ template_config.yearly }}
autosnap = {{ template_config.autosnap | lower }}
autoprune = {{ template_config.autoprune | lower }}

{% endfor %}